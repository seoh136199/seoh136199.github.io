---
title:  "[백준 17822번] 원판 돌리기 [C언어]"

categories:
  - Backjoon
tags:
  - [Algorithm, Backjoon]

toc: true
toc_sticky: true
 
date: 2021-11-11
last_modified_at: 2021-11-11
---

# 17822번: 원판 돌리기 <img src="https://d2gd6pc034wcta.cloudfront.net/tier/13.svg" width="25" height="31"></img>

문제 링크: [17822번: 원판 돌리기](https://www.acmicpc.net/problem/17822, "bj17822")
***

## __전체 코드__

```cpp
#include <stdio.h> 
#include <stdlib.h> 
#pragma warning(disable:4996)
#pragma warning(disable:6031)

int n, m, t, **arr, *rot, **exist;

int deleteSameNum(int, int, int [][50], int);
int rotdY(int, int);
double getAvg();

int main() {

	scanf("%d %d %d", &n, &m, &t);

	arr = malloc(sizeof(int *) * n);
	if (arr == NULL) return -1;
	exist = malloc(sizeof(int *) * n);
	if (exist == NULL) return -1;
	rot = malloc(sizeof(int) * n);
	if (rot == NULL) return -1;

	for (int i = 0; i < n; i++) {
		arr[i] = malloc(sizeof(int) * m);
		if (arr[i] == NULL) return -1;
		exist[i] = malloc(sizeof(int) * m);
		if (exist[i] == NULL) return -1;

		for (int j = 0; j < m; j++) {
			scanf("%d", &arr[i][j]);
			exist[i][j] = 1;
		}
		rot[i] = 0;
	}

	for (int tc = 0; tc < t; tc++) {
		int vstd[50][50] = { 0 };
		int xi, di, ki;
		scanf("%d %d %d", &xi, &di, &ki);
		di = di * 2 - 1;
		for (int x = xi; x <= n; x+=xi) {
			rot[x-1] += di * ki + m;
			rot[x - 1] %= m;
		}

		int existSame = 0;
		for (int i = 0; i < n; i++) {
			for (int j = 0; j < m; j++) {
				if (deleteSameNum(i, j, vstd, 0)) existSame = 1;
			}
		}

		if (!existSame) {
			double avg = getAvg();
			for (int i = 0; i < n; i++) {
				for (int j = 0; j < m; j++) {
					if (exist[i][j] && arr[i][j] > avg) arr[i][j]--;
					else if (exist[i][j] && arr[i][j] < avg) arr[i][j]++;
				}
			}
		}
	}

	int sum = 0;
	for (int i = 0; i < n; i++) {
		for (int j = 0; j < m; j++) {
			if (exist[i][rotdY(i, j)]) sum += arr[i][rotdY(i, j)];
		}
	}

	printf("%d", sum);


	for (int i = 0; i < n; i++) {
		if (arr[i]) free(arr[i]);
		if (exist[i]) free(exist[i]);
	}
	if (arr) free(arr);
	if (exist) free(exist);
	if (rot) free(rot);

	return 0;
}

int deleteSameNum(int x0, int y0, int vstd[][50], int depth) {
	int dx[4] = { 0, 0, 1, -1 };
	int dy[4] = { 1, -1, 0, 0 };

	if (!exist[x0][rotdY(x0, y0)] || vstd[x0][rotdY(x0, y0)]) return 0;

	int existSame = 0;

	vstd[x0][rotdY(x0, y0)] = 1;
	for (int d = 0; d < 4; d++) {
		int x = x0 + dx[d];
		int y = y0 + dy[d];
		if (x >= 0 && x < n && arr[x0][rotdY(x0, y0)] == arr[x][rotdY(x, y)]) {
			existSame = 1;
			deleteSameNum(x, y, vstd, depth + 1);
		}
	}
	if (depth || existSame) arr[x0][rotdY(x0, y0)] = 0, exist[x0][rotdY(x0, y0)] = 0;
	return existSame;
}

int rotdY(int x, int y) {
	return (y + m + rot[x]) % m;
}

double getAvg() {
	int cnt = 0, sum = 0;
	for (int i = 0; i < n; i++) {
		for (int j = 0; j < m; j++) {
			if (exist[i][j]) cnt++, sum += arr[i][j];
		}
	}
	if (!cnt) return 0.0;
	return (double)sum / cnt;
}
```


***